name: Daily Mass Content Import

on:
  schedule:
    # Run every 6 hours (4 times a day: 00:00, 06:00, 12:00, 18:00 UTC)
    - cron: '0 */6 * * *'
  workflow_dispatch: # Allow manual trigger
    inputs:
      limit:
        description: 'Number of items to import'
        required: false
        default: '50'
      pages:
        description: 'Number of pages to scan'
        required: false
        default: '5'

jobs:
  import-content:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          cache: 'pip'

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests supabase google-generativeai python-dotenv

      - name: Run Mass Content Importer
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE: ${{ secrets.SUPABASE_SERVICE_ROLE }}
          TMDB_API_KEY: ${{ secrets.TMDB_API_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          # Limit to 50 items per day to stay within Free Tier limits
          # 50 items * 30 days = 1500 new items per month
          python backend/mass_content_importer.py --limit 50 --pages 5
